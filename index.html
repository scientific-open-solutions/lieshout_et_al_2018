<script src="jquery-3.5.1.min.js"></script>

<style>
#top_circle{
  position: absolute;
  width: 480px;
  height:100px;
  border-radius:50%;
  background-color:#DBDADB;
  border-style: solid;
}

#jar_main{
  position: absolute;
  top: 50px;
  width: 475px;
  height: 650px;
  margin-left:5px;
  background-color:#DBDADB;
  border-radius: 0% 0% 15% 15%;
}

.marble_class{
  position: absolute;
  width:100px;
  height:100px;
  border-radius:50px;
}

#marble_1{
  top:120px;
  left: 25px;
}

#marble_2{
  top:120px;
  left: 135px;
}

#marble_3{
  top:120px;
  left: 245px;
}

#marble_4{
  top:120px;
  left: 355px;
}

#marble_5{
  top:230px;
  left: 25px;
}

#marble_6{
  top:230px;
  left: 135px;
}

#marble_7{
  top:230px;
  left: 245px;
}

#marble_8{
  top:230px;
  left: 355px;
}

#marble_9{
  top:340px;
  left: 25px;
}

#marble_10{
  top:340px;
  left: 135px;
}

#marble_11{
  top:340px;
  left: 245px;
}

#marble_12{
  top:340px;
  left: 355px;
}

#marble_13{
  top:450px;
  left: 25px;
}

#marble_14{
  top:450px;
  left: 135px;
}

#marble_15{
  top:450px;
  left: 245px;
}

#marble_16{
  top:450px;
  left: 355px;
}

#marble_17{
  top:560px;
  left: 25px;
}

#marble_18{
  top:560px;
  left: 135px;
}

#marble_19{
  top:560px;
  left: 245px;
}

#marble_0{
  top:560px;
  left: 355px;
}

#marble_legend_col1{
  top:  280px;
  left: 700px;
  background-color:firebrick;
}

#marble_legend_col2{
  top:  400px;
  left: 700px;
  background-color:mediumBlue;
}

.legend{
  position: absolute;
   font-family:Calibri;
   font-size:40px;
}

#legend_val1{
  top:305px;
  left:820px;
}

#legend_val2{
  top:425px;
  left:820px;
}

.curious_option{
  position: absolute;
  width:100px;
  height:100px;
  justify-content: center;
  background-color:grey;
  border-radius: 15% 15% 15% 15%;
}

#curious_1{
  top: 50px;

}

#curious_2{
  position: absolute;
  top: 50px;
  left: 120;
}

#curious_3{
  position: absolute;
  top: 50px;
  left: 230;
}

#curious_4{
  position: absolute;
  top: 50px;
  left: 340;
}

.content{
   display: flex;
   align-items: center;
   justify-content: center;
   vertical-align: middle;
}

#phase_1,
#phase_2,
#phase_3{
  display:none;
}


</style>

<!-- use the stuff on the left for comments
  HTML here
-->
<div id="phase_1">
  <body style="background-color:powdergrey;">
  <div id="jar_main"></div>
  <div id="top_circle"></div>
  <div id="marble_0" class="marble_class"></div>
  <div id="marble_1" class="marble_class"></div>
  <div id="marble_2" class="marble_class"></div>
  <div id="marble_3" class="marble_class"></div>
  <div id="marble_4" class="marble_class"></div>
  <div id="marble_5" class="marble_class"></div>
  <div id="marble_6" class="marble_class"></div>
  <div id="marble_7" class="marble_class"></div>
  <div id="marble_8" class="marble_class"></div>
  <div id="marble_9" class="marble_class"></div>
  <div id="marble_10" class="marble_class"></div>
  <div id="marble_11" class="marble_class"></div>
  <div id="marble_12" class="marble_class"></div>
  <div id="marble_13" class="marble_class"></div>
  <div id="marble_14" class="marble_class"></div>
  <div id="marble_15" class="marble_class"></div>
  <div id="marble_16" class="marble_class"></div>
  <div id="marble_17" class="marble_class"></div>
  <div id="marble_18" class="marble_class"></div>
  <div id="marble_19" class="marble_class"></div>
  <div id="marble_legend_col1" class ="marble_class"></div>
  <div id="marble_legend_col2" class ="marble_class"></div>
  <div id="legend_val1" class = "legend">N points</div>
  <div id="legend_val2" class = "legend">N points</div>
</div>

<div id="phase_2">

  How curious were you? (1-4)
  <div id="curious_1" class="curious_option">
    <div class ="content">
      <p>1</p>
    </div>
  </div>
  <div id="curious_2" class="curious_option">
    <div class ="content">
      <p>2</p>
    </div>
  </div>
  <div id="curious_3" class="curious_option">
    <div class ="content">
      <p>3</p>
    </div>
  </div>
  <div id="curious_4" class="curious_option">
    <div class ="content">
      <p>4</p>
    </div>
  </div>
  <input name="option_clicked" id="option_clicked"/>
</div>

<div id="phase_3">
Outcome: <br>
<div id="outcome_color"></div>
<div id="outcome_reveal"></div>
</div>

<script>

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

var combinations_obj = {
  "20": 18,
  "19": 153,
  "15": 153,
  "10": 153
}

var color_order = Array(239).fill("firebrick")
                            .concat(Array(238)
                            .fill("mediumBlue"))


/* Shuffled array of points associated with colour 1 (just 1 rep of each category for this example) */

var points_order = [
  "10","20","30","40","50","60","70","80","90"
]

shuffleArray(points_order);

for(i=0; i< points_order.length;i++){

/* take value 1 in legend from points_order; value 2 is 100 - value 1   */

  document.getElementById("legend_val1").innerHTML = points_order[i] + " points";
  document.getElementById("legend_val2").innerHTML = 100 - points_order[i] + " points";
};

/*
* Create list
*/
var percentage_order = [];

for(var i = 0; i < combinations_obj["20"]; i++){
  percentage_order.push("20");
}
for(var i = 0; i < combinations_obj["19"]; i++){
  percentage_order.push("19");
}
for(var i = 0; i < combinations_obj["15"]; i++){
  percentage_order.push("15");
}
for(var i = 0; i < combinations_obj["10"]; i++){
  percentage_order.push("10");
}

/*
* Randomise list order
*/
shuffleArray(percentage_order);
shuffleArray(color_order);

var  this_percentage = percentage_order.pop();
var default_color = color_order.pop();

if(default_color == "firebrick"){
  other_color = "mediumBlue";
} else {
  other_color = "firebrick";
}

var jar_color_order = Array(parseFloat(this_percentage)).fill(default_color)
                            .concat(Array(20-parseFloat(this_percentage))
                            .fill(other_color))

shuffleArray(jar_color_order);


/* Added jitter to marble position */
var jitter_max = 5
var jitter_min = -5

for(i=0; i< jar_color_order.length;i++){
  $("#marble_"+i).css("background-color",jar_color_order[i]);

old_top = $("#marble_"+i).css("top");
old_left = $("#marble_"+i).css("left");

  $("#marble_"+i).css("top",(parseInt(old_top,10) + Math.floor(Math.random() * (jitter_max - jitter_min + 1)) + jitter_min) + "px");
  $("#marble_"+i).css("left",(parseInt(old_left,10) + Math.floor(Math.random() * (jitter_max - jitter_min + 1)) + jitter_min) + "px");
};

/*
* Check if array has 4+ repeats
*/
/*
var in_a_row = 0;
var working_list = [percentage_order[0]];
var failed_list = [];
for(var i = 1; i < percentage_order.length; i++){
  if(percentage_order[i-1] == percentage_order[i]){
    in_a_row++;
  } else {
    in_a_row = 0;
  }
  if(in_a_row > 3){
    console.log(in_a_row);
    console.log("i");
    console.log(i);



  } else {
    working_list.push(percentage_order[i]);
  }
}
*/




/*
* Phase 0
*/
setTimeout(function(){
  run_phase_1();
},500);

// code here to set the colors of the marbles



/*
* Phase 1
*/
function run_phase_1(){
  $("#phase_1").show();
  setTimeout(function(){
    $("#phase_1").hide();
    setTimeout(function(){
      run_phase_2()
    },500);
  },3000);
}

/*
* Phase 2
*/
function run_phase_2(){
  $("#phase_2").show();
  setTimeout(function(){
    $("#phase_2").hide();
    setTimeout(function(){
      run_phase_3();
    },500);
  },4000);
}


/*
* Phase 3
*/
function run_phase_3(){
  $("#phase_3").show();
}


$(".curious_option").on("click",function(){
  $("#option_clicked").val(this.id);
});

/*
* Send data
*/
function send_data(this_data, this_participant){
  $.post("http://kousos-org.stackstaging.com/server_h38s7ahsdje67fgwhe5.php", {
    "data":        this_data,
    "experiment":  "lieshoult_2018",
    "participant": this_participant
  }, function(result){
    if(result !== "success"){
      alert(result);
    }
  });
}
</script>
